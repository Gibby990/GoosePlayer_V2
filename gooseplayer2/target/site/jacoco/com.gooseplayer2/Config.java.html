<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Config.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gooseplayer2</a> &gt; <a href="index.source.html" class="el_package">com.gooseplayer2</a> &gt; <span class="el_source">Config.java</span></div><h1>Config.java</h1><pre class="source lang-java linenums">package com.gooseplayer2;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.FileOutputStream;
import java.awt.*;
import java.util.Properties;
import java.util.Objects;
import com.formdev.flatlaf.intellijthemes.*;

import javax.swing.*;

import com.gooseplayer2.Packages.Slugcat;

public class Config extends JDialog {
<span class="fc" id="L20">    public static final String SETTINGS_FILE_PATH = initSettingsPath();</span>
<span class="fc" id="L21">    public static final String LIBRARY_PATH = initLibraryPath();</span>
<span class="fc" id="L22">    public static final String RESOURCES_FILE_PATH = System.getProperty(&quot;user.dir&quot;)+ File.separator + &quot;gooseplayer2&quot; + File.separator + &quot;src&quot; + File.separator + &quot;main&quot; + File.separator + &quot;resources&quot;;</span>

    private GridBagConstraints gbc;
    private GridBagLayout layout;
    private Properties p;
    private FileReader reader;
    private Slugcat Artificer; 

    private String currentTheme, currentStyle, currentMonoChannelName, currentMultiChannel1Name, currentMultiChannel2Name, currentMultiChannel3Name;

    private JButton saveButton;
    @SuppressWarnings(&quot;rawtypes&quot;)
    private JComboBox ThemeBox, StyleBox;
    private JSeparator Seperator;
    private JTextField MonoChannelField, MultiChannel1Field, MultiChannel2Field, MultiChannel3Field;
    private JTextField LibraryField;
    private JButton libraryBrowseButton, libraryDefaultButton;
    private JLabel ThemeLabel, StyleLabel, RestartWarning, MonoChannelLabel, MultiChannel1Label, MultiChannel2Label, MultiChannel3Label, LibraryLabel;
    
    public Config(JFrame parent) throws IOException {
<span class="nc" id="L42">        super(parent, &quot;Settings&quot;, true);</span>
<span class="nc" id="L43">        setSize(500, 300);</span>
<span class="nc" id="L44">        setLocationRelativeTo(parent);</span>

<span class="nc" id="L46">        layout = new GridBagLayout();</span>
<span class="nc" id="L47">        gbc = new GridBagConstraints();</span>

<span class="nc" id="L49">        Seperator = new JSeparator();</span>
<span class="nc" id="L50">        Seperator.setOrientation(SwingConstants.HORIZONTAL); </span>

<span class="nc" id="L52">        Artificer = new Slugcat();</span>

<span class="nc" id="L54">        reader = new FileReader(SETTINGS_FILE_PATH);</span>
<span class="nc" id="L55">        p = new Properties();</span>
<span class="nc" id="L56">        p.load(reader);</span>

<span class="nc" id="L58">        currentTheme = p.getProperty(&quot;theme&quot;);</span>
<span class="nc" id="L59">        currentStyle = p.getProperty(&quot;style&quot;);</span>
<span class="nc" id="L60">        currentMonoChannelName = p.getProperty(&quot;monochannelname&quot;);</span>
<span class="nc" id="L61">        currentMultiChannel1Name = p.getProperty(&quot;multichannel1name&quot;);</span>
<span class="nc" id="L62">        currentMultiChannel2Name = p.getProperty(&quot;multichannel2name&quot;);</span>
<span class="nc" id="L63">        currentMultiChannel3Name = p.getProperty(&quot;multichannel3name&quot;);</span>
<span class="nc" id="L64">        String configuredLibrary = p.getProperty(&quot;librarypath&quot;);</span>
        String currentLibraryPath;
<span class="nc bnc" id="L66" title="All 4 branches missed.">        if (configuredLibrary == null || configuredLibrary.isEmpty()) {</span>
<span class="nc" id="L67">            currentLibraryPath = LIBRARY_PATH;</span>
        } else {
<span class="nc" id="L69">            currentLibraryPath = configuredLibrary;</span>
        }

        //Theme List
<span class="nc" id="L73">        String[] themeList = {&quot;Light Flat&quot;, &quot;Solarized Light&quot;, &quot;Arc&quot;, &quot;Dark Flat&quot;, &quot;Arc Dark&quot;, &quot;Arc Dark Orange&quot;, &quot;Hiberbee Dark&quot;, &quot;Dark Purple&quot;, &quot;Nord&quot;};</span>
<span class="nc" id="L74">        String[] styleList = {&quot;Monochannel&quot;, &quot;Multichannel&quot;};</span>

<span class="nc" id="L76">        ThemeBox = new JComboBox&lt;&gt;(themeList);</span>
<span class="nc" id="L77">        ThemeBox.setSelectedItem(currentTheme);</span>
<span class="nc" id="L78">        ThemeBox.addActionListener(new ActionListener() {</span>
            @SuppressWarnings(&quot;rawtypes&quot;)
            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L82">                try (FileWriter writer = new FileWriter(SETTINGS_FILE_PATH)) {</span>
<span class="nc" id="L83">                    JComboBox cb = (JComboBox)e.getSource();</span>
<span class="nc" id="L84">                    String selectedTheme = (String)cb.getSelectedItem();</span>
<span class="nc" id="L85">                    p.setProperty(&quot;theme&quot;, selectedTheme);</span>
<span class="nc" id="L86">                    p.store(writer, null);</span>
<span class="nc" id="L87">                    currentTheme = selectedTheme;</span>
<span class="nc" id="L88">                    applySettings();</span>
<span class="nc" id="L89">                } catch (IOException e1) {</span>
<span class="nc" id="L90">                    e1.printStackTrace();</span>
<span class="nc" id="L91">                }</span>
<span class="nc" id="L92">            }</span>
        });
<span class="nc" id="L94">        ThemeLabel = new JLabel(&quot;Theme: &quot;);</span>

<span class="nc" id="L96">        RestartWarning = new JLabel(&quot;&lt;html&gt;&quot; + &quot;&lt;B&gt;&quot; + &quot;WARNING: Changes below will restart program&quot; + &quot;&lt;/B&gt;&quot; + &quot;&lt;/html&gt;&quot;);</span>

<span class="nc" id="L98">        StyleBox = new JComboBox&lt;&gt;(styleList);</span>
<span class="nc" id="L99">        StyleBox.setSelectedItem(currentStyle);</span>
<span class="nc" id="L100">        StyleBox.addActionListener(new ActionListener() {</span>
            @SuppressWarnings(&quot;rawtypes&quot;)
            @Override
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L104">                try (FileWriter writer = new FileWriter(SETTINGS_FILE_PATH)) {</span>
<span class="nc" id="L105">                    JComboBox cb = (JComboBox)e.getSource();</span>
<span class="nc" id="L106">                    String selectedStyle = (String)cb.getSelectedItem();</span>
<span class="nc" id="L107">                    p.setProperty(&quot;style&quot;, selectedStyle);</span>
<span class="nc" id="L108">                    p.store(writer, null);</span>
<span class="nc" id="L109">                } catch (IOException e1) {</span>
<span class="nc" id="L110">                    e1.printStackTrace();</span>
<span class="nc" id="L111">                }</span>
<span class="nc" id="L112">            }</span>
        });

<span class="nc" id="L115">        StyleLabel = new JLabel(&quot;Style: &quot;);</span>

<span class="nc" id="L117">        MonoChannelLabel = new JLabel(&quot;MonoChannel Name:&quot;);</span>
<span class="nc" id="L118">        MonoChannelField = new JTextField();</span>
<span class="nc" id="L119">        MonoChannelField.setText(currentMonoChannelName);</span>

<span class="nc" id="L121">        MultiChannel1Label = new JLabel(&quot;MultiChannel 1 Name&quot;);</span>
<span class="nc" id="L122">        MultiChannel1Field = new JTextField();</span>
<span class="nc" id="L123">        MultiChannel1Field.setText(currentMultiChannel1Name);</span>

<span class="nc" id="L125">        MultiChannel2Label = new JLabel(&quot;MultiChannel 2 Name&quot;);</span>
<span class="nc" id="L126">        MultiChannel2Field = new JTextField();</span>
<span class="nc" id="L127">        MultiChannel2Field.setText(currentMultiChannel2Name);</span>

<span class="nc" id="L129">        MultiChannel3Label = new JLabel(&quot;MultiChannel 3 Name&quot;);</span>
<span class="nc" id="L130">        MultiChannel3Field = new JTextField();</span>
<span class="nc" id="L131">        MultiChannel3Field.setText(currentMultiChannel3Name);</span>

<span class="nc" id="L133">        LibraryLabel = new JLabel(&quot;Library Folder&quot;);</span>
<span class="nc" id="L134">        LibraryField = new JTextField();</span>
<span class="nc" id="L135">        LibraryField.setText(currentLibraryPath);</span>

<span class="nc" id="L137">        libraryBrowseButton = new JButton(&quot;Browse...&quot;);</span>
<span class="nc" id="L138">        libraryBrowseButton.addActionListener(e -&gt; {</span>
<span class="nc" id="L139">            JFileChooser chooser = new JFileChooser();</span>
<span class="nc" id="L140">            chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);</span>
            try {
<span class="nc" id="L142">                File startDir = new File(LibraryField.getText());</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">                if (startDir.exists()) chooser.setCurrentDirectory(startDir);</span>
<span class="nc" id="L144">            } catch (Exception ignored) {}</span>
<span class="nc" id="L145">            int result = chooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">            if (result == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L147">                File selected = chooser.getSelectedFile();</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">                if (selected != null) {</span>
<span class="nc" id="L149">                    LibraryField.setText(selected.getAbsolutePath());</span>
                }
            }
<span class="nc" id="L152">        });</span>

<span class="nc" id="L154">        libraryDefaultButton = new JButton(&quot;Use Built-in&quot;);</span>
<span class="nc" id="L155">        libraryDefaultButton.addActionListener(e -&gt; {</span>
<span class="nc" id="L156">            String builtIn = computeDefaultLibraryPath();</span>
<span class="nc" id="L157">            LibraryField.setText(builtIn);</span>
<span class="nc" id="L158">        });</span>

<span class="nc" id="L160">        JPanel libraryPathPanel = new JPanel();</span>
<span class="nc" id="L161">        libraryPathPanel.setLayout(new BorderLayout(5, 0));</span>
<span class="nc" id="L162">        libraryPathPanel.add(LibraryField, BorderLayout.CENTER);</span>
<span class="nc" id="L163">        JPanel libraryButtons = new JPanel(new FlowLayout(FlowLayout.RIGHT, 5, 0));</span>
<span class="nc" id="L164">        libraryButtons.add(libraryDefaultButton);</span>
<span class="nc" id="L165">        libraryButtons.add(libraryBrowseButton);</span>
<span class="nc" id="L166">        libraryPathPanel.add(libraryButtons, BorderLayout.EAST);</span>

<span class="nc" id="L168">        saveButton = new JButton(&quot;Save&quot;); //Only works for Themes</span>
<span class="nc" id="L169">        saveButton.addActionListener(e -&gt; {</span>
<span class="nc" id="L170">            boolean restartNeeded = saveSettings();</span>
<span class="nc" id="L171">            dispose();</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">            if (restartNeeded) {</span>
<span class="nc" id="L173">                restartApplication();</span>
            }
<span class="nc" id="L175">        });</span>
        
        //Layout

<span class="nc" id="L179">        setLayout(layout);</span>

<span class="nc" id="L181">        gbc.gridheight = 1;</span>
<span class="nc" id="L182">        gbc.gridwidth = 1;</span>
<span class="nc" id="L183">        gbc.weightx = 1.0;</span>
<span class="nc" id="L184">        gbc.weighty = 1.0;</span>
<span class="nc" id="L185">        gbc.fill = GridBagConstraints.NONE;</span>

<span class="nc" id="L187">        Artificer.addObjects(ThemeLabel, this, layout, gbc, 0, 0, 1, 1);</span>
<span class="nc" id="L188">        Artificer.addObjects(ThemeBox, this, layout, gbc, 1, 0, 1, 1);</span>

<span class="nc" id="L190">        gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L191">        Artificer.addObjects(Seperator, this, layout, gbc, 0, 1, 2, 1);</span>
        
<span class="nc" id="L193">        gbc.insets = new Insets(0, 10, 0, 0);</span>
<span class="nc" id="L194">        Artificer.addObjects(RestartWarning, this, layout, gbc, 0, 2, 2, 1);</span>
<span class="nc" id="L195">        gbc.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L196">        gbc.fill = GridBagConstraints.NONE;</span>

<span class="nc" id="L198">        Artificer.addObjects(StyleLabel, this, layout, gbc, 0, 3, 1, 1);</span>
<span class="nc" id="L199">        Artificer.addObjects(StyleBox, this , layout, gbc, 1, 3, 1, 1);</span>

<span class="nc" id="L201">        Artificer.addObjects(MonoChannelLabel, this, layout, gbc, 0, 5, 1, 1);</span>
<span class="nc" id="L202">        Artificer.addObjects(MonoChannelField, this, layout, gbc,1, 5, 1, 1);</span>

<span class="nc" id="L204">        Artificer.addObjects(MultiChannel1Label, this, layout, gbc, 0, 6, 1, 1);</span>
<span class="nc" id="L205">        Artificer.addObjects(MultiChannel1Field, this, layout, gbc, 1, 6, 1, 1);</span>

<span class="nc" id="L207">        Artificer.addObjects(MultiChannel2Label, this, layout, gbc, 0, 7, 1, 1);</span>
<span class="nc" id="L208">        Artificer.addObjects(MultiChannel2Field, this, layout, gbc, 1, 7, 1, 1);</span>

<span class="nc" id="L210">        Artificer.addObjects(MultiChannel3Label, this, layout, gbc, 0, 8, 1, 1);</span>
<span class="nc" id="L211">        Artificer.addObjects(MultiChannel3Field, this, layout, gbc, 1, 8, 1, 1);</span>

<span class="nc" id="L213">        Artificer.addObjects(LibraryLabel, this, layout, gbc, 0, 9, 1, 1);</span>
<span class="nc" id="L214">        Artificer.addObjects(libraryPathPanel, this, layout, gbc, 1, 9, 1, 1);</span>

<span class="nc" id="L216">        gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L217">        Artificer.addObjects(saveButton, this, layout, gbc, 0, 10, 2, 1);</span>
<span class="nc" id="L218">    }</span>

    private static String initLibraryPath() {
        try {
<span class="fc" id="L222">            Properties props = new Properties();</span>
<span class="fc" id="L223">            props.load(new FileReader(SETTINGS_FILE_PATH));</span>
<span class="fc" id="L224">            String configured = props.getProperty(&quot;librarypath&quot;);</span>
<span class="pc bpc" id="L225" title="3 of 4 branches missed.">            if (configured != null &amp;&amp; !configured.isEmpty()) {</span>
<span class="nc" id="L226">                File cfgDir = new File(configured);</span>
<span class="nc bnc" id="L227" title="All 4 branches missed.">                if (cfgDir.exists() &amp;&amp; cfgDir.isDirectory()) {</span>
<span class="nc" id="L228">                    return cfgDir.getAbsolutePath();</span>
                }
            }
<span class="pc" id="L231">        } catch (Exception ignored) {}</span>
<span class="fc" id="L232">        return computeDefaultLibraryPath();</span>
    }

    private static String computeDefaultLibraryPath() {
<span class="fc" id="L236">        String cwdLibrary = System.getProperty(&quot;user.dir&quot;) + File.separator + &quot;Library&quot;;</span>
<span class="fc" id="L237">        File cwdDir = new File(cwdLibrary);</span>
<span class="pc bpc" id="L238" title="2 of 4 branches missed.">        if (cwdDir.exists() &amp;&amp; cwdDir.isDirectory()) {</span>
<span class="fc" id="L239">            return cwdDir.getAbsolutePath();</span>
        }

<span class="nc" id="L242">        String devPath = System.getProperty(&quot;user.dir&quot;) + File.separator + &quot;gooseplayer2&quot; + File.separator + &quot;src&quot; + File.separator + &quot;Library&quot;;</span>
<span class="nc" id="L243">        File devDir = new File(devPath);</span>
<span class="nc bnc" id="L244" title="All 4 branches missed.">        if (devDir.exists() &amp;&amp; devDir.isDirectory()) {</span>
<span class="nc" id="L245">            return devDir.getAbsolutePath();</span>
        }

        try {
<span class="nc" id="L249">            File codeSource = new File(Config.class.getProtectionDomain().getCodeSource().getLocation().toURI());</span>
<span class="nc" id="L250">            File jarDir = codeSource.getParentFile();</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">            if (jarDir != null) {</span>
<span class="nc" id="L252">                File libDir = new File(jarDir, &quot;Library&quot;);</span>
<span class="nc bnc" id="L253" title="All 4 branches missed.">                if (libDir.exists() &amp;&amp; libDir.isDirectory()) {</span>
<span class="nc" id="L254">                    return libDir.getAbsolutePath();</span>
                }
            }
<span class="nc" id="L257">        } catch (Exception ignored) {}</span>

<span class="nc bnc" id="L259" title="All 2 branches missed.">        if (!cwdDir.exists()) {</span>
<span class="nc" id="L260">            cwdDir.mkdirs();</span>
        }
<span class="nc" id="L262">        return cwdDir.getAbsolutePath();</span>
    }

    private boolean saveSettings() {
<span class="nc" id="L266">        boolean restartRequired = false;</span>
<span class="nc" id="L267">        try (FileWriter writer = new FileWriter(SETTINGS_FILE_PATH)) {</span>

            // Detect changes that require restart (non-theme settings)
<span class="nc bnc" id="L270" title="All 2 branches missed.">            boolean styleChanged = !Objects.equals(currentStyle, p.getProperty(&quot;style&quot;));</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">            boolean monoChanged = !Objects.equals(currentMonoChannelName, MonoChannelField.getText());</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">            boolean multi1Changed = !Objects.equals(currentMultiChannel1Name, MultiChannel1Field.getText());</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            boolean multi2Changed = !Objects.equals(currentMultiChannel2Name, MultiChannel2Field.getText());</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">            boolean multi3Changed = !Objects.equals(currentMultiChannel3Name, MultiChannel3Field.getText());</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">            boolean libraryChanged = !Objects.equals(p.getProperty(&quot;librarypath&quot;, LIBRARY_PATH), LibraryField.getText());</span>

            // Persist updates
<span class="nc" id="L278">            p.setProperty(&quot;monochannelname&quot;, MonoChannelField.getText());</span>
<span class="nc" id="L279">            p.setProperty(&quot;multichannel1name&quot;, MultiChannel1Field.getText());</span>
<span class="nc" id="L280">            p.setProperty(&quot;multichannel2name&quot;, MultiChannel2Field.getText());</span>
<span class="nc" id="L281">            p.setProperty(&quot;multichannel3name&quot;, MultiChannel3Field.getText());</span>
<span class="nc" id="L282">            p.setProperty(&quot;librarypath&quot;, LibraryField.getText());</span>

<span class="nc" id="L284">            p.store(writer, null);</span>

            // Apply theme immediately; other changes may need restart
<span class="nc" id="L287">            applySettings();</span>

<span class="nc bnc" id="L289" title="All 12 branches missed.">            restartRequired = styleChanged || monoChanged || multi1Changed || multi2Changed || multi3Changed || libraryChanged;</span>
<span class="nc" id="L290">        } catch (IOException e) {</span>
<span class="nc" id="L291">            e.printStackTrace();</span>
<span class="nc" id="L292">        }</span>
<span class="nc" id="L293">        return restartRequired;</span>
    }

    public static void applySettings() {
<span class="fc" id="L297">        SwingUtilities.invokeLater(() -&gt; {</span>
            try {
<span class="fc" id="L299">                UIManager.setLookAndFeel(UIManager.getCrossPlatformLookAndFeelClassName());</span>
<span class="fc" id="L300">                Properties p = new Properties();</span>
<span class="fc" id="L301">                p.load(new FileReader(SETTINGS_FILE_PATH));</span>

<span class="fc" id="L303">                applyTheme(p.getProperty(&quot;theme&quot;, &quot;&quot;));</span>

<span class="nc" id="L305">            } catch (Exception e) {</span>
<span class="nc" id="L306">                e.printStackTrace();</span>
<span class="fc" id="L307">            }</span>
<span class="fc" id="L308">            SwingUtilities.updateComponentTreeUI(JFrame.getFrames()[0]);</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">            for (Window window : Window.getWindows()) {</span>
<span class="fc" id="L310">                SwingUtilities.updateComponentTreeUI(window);</span>
            }
<span class="fc" id="L312">        });</span>
<span class="fc" id="L313">    }</span>

    public static void applyTheme(String theme) {
<span class="pc bpc" id="L316" title="9 of 10 branches missed.">        switch (theme) {</span>
            case &quot;Light Flat&quot;:
<span class="nc" id="L318">                FlatLightFlatIJTheme.setup();</span>
<span class="nc" id="L319">                break;</span>
            case &quot;Solarized Light&quot;:
<span class="nc" id="L321">                FlatSolarizedLightIJTheme.setup();</span>
<span class="nc" id="L322">                break;</span>
            case &quot;Arc&quot; :
<span class="nc" id="L324">                FlatArcIJTheme.setup();</span>
<span class="nc" id="L325">                break;</span>
            case &quot;Dark Flat&quot;:
<span class="nc" id="L327">                FlatDarkFlatIJTheme.setup();</span>
<span class="nc" id="L328">                break;</span>
            case &quot;Arc Dark&quot;: 
<span class="nc" id="L330">                FlatArcDarkIJTheme.setup();</span>
<span class="nc" id="L331">                break;</span>
            case &quot;Arc Dark Orange&quot;:
<span class="fc" id="L333">                FlatArcDarkOrangeIJTheme.setup();</span>
<span class="fc" id="L334">                break;</span>
            case &quot;Hiberbee Dark&quot;:
<span class="nc" id="L336">                FlatHiberbeeDarkIJTheme.setup();</span>
<span class="nc" id="L337">                break;</span>
            case &quot;Dark Purple&quot;:
<span class="nc" id="L339">                FlatDarkPurpleIJTheme.setup();</span>
<span class="nc" id="L340">                break;</span>
            case &quot;Nord&quot;:
<span class="nc" id="L342">                FlatNordIJTheme.setup();</span>
<span class="nc" id="L343">                break;</span>
            default:
<span class="nc" id="L345">                FlatLightFlatIJTheme.setup();</span>
                break;
        }
<span class="fc" id="L348">    }</span>

    private static String initSettingsPath() {
<span class="fc" id="L351">        String appData = System.getenv(&quot;APPDATA&quot;);</span>
        String targetPath;
<span class="pc bpc" id="L353" title="2 of 4 branches missed.">        if (appData != null &amp;&amp; !appData.isEmpty()) {</span>
<span class="fc" id="L354">            targetPath = appData + File.separator + &quot;GoosePlayer2&quot; + File.separator + &quot;settings.txt&quot;;</span>
        } else {
<span class="nc" id="L356">            targetPath = System.getProperty(&quot;user.dir&quot;) + File.separator + &quot;settings.txt&quot;;</span>
        }

<span class="fc" id="L359">        File settingsFile = new File(targetPath);</span>
<span class="fc" id="L360">        File parentDir = settingsFile.getParentFile();</span>
<span class="pc bpc" id="L361" title="2 of 4 branches missed.">        if (parentDir != null &amp;&amp; !parentDir.exists()) {</span>
<span class="nc" id="L362">            parentDir.mkdirs();</span>
        }

<span class="pc bpc" id="L365" title="1 of 2 branches missed.">        if (!settingsFile.exists()) {</span>
<span class="nc" id="L366">            try (InputStream in = Config.class.getResourceAsStream(&quot;/settings.txt&quot;)) {</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">                if (in != null) {</span>
<span class="nc" id="L368">                    try (FileOutputStream out = new FileOutputStream(settingsFile)) {</span>
<span class="nc" id="L369">                        byte[] buffer = new byte[8192];</span>
                        int read;
<span class="nc bnc" id="L371" title="All 2 branches missed.">                        while ((read = in.read(buffer)) != -1) {</span>
<span class="nc" id="L372">                            out.write(buffer, 0, read);</span>
                        }
                    }
                } else {
<span class="nc" id="L376">                    settingsFile.createNewFile();</span>
                }
<span class="nc" id="L378">            } catch (IOException e) {</span>
<span class="nc" id="L379">                e.printStackTrace();</span>
<span class="nc" id="L380">            }</span>
        }

<span class="fc" id="L383">        return settingsFile.getAbsolutePath();</span>
    }

    private static void restartApplication() {
        try {
<span class="nc" id="L388">            String javaBinBase = System.getProperty(&quot;java.home&quot;) + File.separator + &quot;bin&quot; + File.separator + &quot;java&quot;;</span>
<span class="nc" id="L389">            String javaBin = javaBinBase;</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">            if (System.getProperty(&quot;os.name&quot;).toLowerCase().contains(&quot;win&quot;)) {</span>
<span class="nc" id="L391">                File javaExe = new File(javaBinBase + &quot;.exe&quot;);</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">                if (javaExe.exists()) {</span>
<span class="nc" id="L393">                    javaBin = javaExe.getAbsolutePath();</span>
                }
            }

<span class="nc" id="L397">            String classPath = System.getProperty(&quot;java.class.path&quot;);</span>
<span class="nc" id="L398">            String mainClass = &quot;com.gooseplayer2.Main&quot;;</span>

<span class="nc" id="L400">            ProcessBuilder builder = new ProcessBuilder(javaBin, &quot;-cp&quot;, classPath, mainClass);</span>
<span class="nc" id="L401">            builder.directory(new File(System.getProperty(&quot;user.dir&quot;)));</span>
<span class="nc" id="L402">            builder.start();</span>
<span class="nc" id="L403">        } catch (IOException ex) {</span>
<span class="nc" id="L404">            ex.printStackTrace();</span>
<span class="nc" id="L405">            return;</span>
<span class="nc" id="L406">        }</span>
<span class="nc" id="L407">        System.exit(0);</span>
<span class="nc" id="L408">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>